/*
 * Empty C++ Application
 */


#include "xparameters.h"
#include "xil_io.h"
#include "sleep.h"

//Used object classes
#include "Objects/Frog.h"
#include "Objects/GameObject.h"
#include "Objects/Controls.h"
#include "Objects/Background.h"

#include "definitions.h"

int main()
{
	Background objBg = Background();
	Background *playerBg = &objBg;

	//Frog(uint16_t posX, uint16_t posY, Background *bgPtr, uint8_t speed);
	Frog objFrog = Frog(446,690,playerBg,1);
	Frog *playerFrog = &objFrog;

	//Controls(Frog *frogPtr, Background *bgPtr)
	Controls objKeyboard = Controls(playerFrog, playerBg);
	Controls *playerKeyboard = &objKeyboard;

	//GameObject(uint16_t height, uint16_t width, uint16_t pos_x, uint16_t pos_y, Background *bgPtr, uint8_t speed, uint8_t objIndex, uint8_t moduleId, enum Direction _direction)
	GameObject car1 = GameObject(64, 64, 20, TILE1_HEIGHT_OFFSET+82, playerBg, 1, 1, 2, GameObject::Right);
	GameObject car2 = GameObject(64, 64, 350, TILE1_HEIGHT_OFFSET+82, playerBg, 1, 2, 2, GameObject::Right);
	GameObject car3 = GameObject(64, 64, 700, TILE3_HEIGHT_OFFSET+82, playerBg, 1, 3, 2, GameObject::Left);
	GameObject car4 = GameObject(64, 64, 80, TILE3_HEIGHT_OFFSET+82, playerBg, 1, 4, 2, GameObject::Left);
	GameObject car5 = GameObject(64, 64, 450, TILE4_HEIGHT_OFFSET+82, playerBg, 1, 5, 2, GameObject::Right);

	GameObject testSubject = GameObject(64, 64, 500, TILE6_HEIGHT_OFFSET+82, playerBg, 1, 6, 2, GameObject::None);

	GameObject* gameObjects[] = {&car1, &car2, &car3, &car4, &car5, &testSubject};

	uint32_t random = 0;

	while(1){

		random = Xil_In32(RNG_BASEADDR);
		//testSubject.setPosX(random);

		for( int i = 0; i<6; i++){
			gameObjects[i]->draw();
			gameObjects[i]->updatePos();
		}


		playerKeyboard->getKeyboardAction();
		playerFrog->updatePos();
		playerFrog->draw();

		playerBg->update();
		playerBg->draw();

		if(playerFrog->IsColliding(gameObjects, 6))
			playerFrog->reset();

		usleep(20000);
	}
}

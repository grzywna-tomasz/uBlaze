/*
 * Empty C++ Application
 */


#include "xparameters.h"
#include "xil_io.h"
#include "sleep.h"

//Used object classes
#include "Objects/Frog.h"
#include "Objects/GameObject.h"
#include "Objects/Controls.h"
#include "Objects/Background.h"
#include "Objects/Car.h"

#include "definitions.h"

void tileTransition(GameObject **gameObjects, Background objBg){
	uint8_t stop = 1;
	uint8_t cnt = 0;
	if(objBg.isTransitionOn()){
		for (int i = 0; i<10; i++){
			if (gameObjects[i]->getPosY() < 856)
				gameObjects[i]->transitionY();
		}
	}
	else {
		if (objBg.getBgNxt() == Background::Highway){
			while (stop){
				if (gameObjects[cnt]->getPosY() == 40)
					stop = 0;
				else{
					if (gameObjects[cnt]->getPosY() >= 856){
						gameObjects[cnt]->setPosY(40);
						gameObjects[cnt+1]->setPosY(40);
						stop = 0;
					}
					else if (cnt == 12)
						stop = 0;
					else
						cnt = cnt + 2;
				}
			}
		}
	}

}

int main()
{
	Background objBg = Background();
	Background *playerBg = &objBg;

	//Frog(uint16_t posX, uint16_t posY, Background *bgPtr, uint8_t speed);
	Frog objFrog = Frog(446,690,playerBg,1);
	Frog *playerFrog = &objFrog;

	//Controls(Frog *frogPtr, Background *bgPtr)
	Controls objKeyboard = Controls(playerFrog, playerBg);
	Controls *playerKeyboard = &objKeyboard;

	//GameObject(uint16_t height, uint16_t width, uint16_t pos_x, uint16_t pos_y, Background *bgPtr, uint8_t speed, uint8_t objIndex, uint8_t moduleId, enum Direction _direction)
	/*
	GameObject car1 = GameObject(64, 64, 620, TILE1_HEIGHT_OFFSET+82, playerBg, 1, 1, 2, GameObject::Right);
	GameObject truck1 = GameObject(64, 128, 350, TILE1_HEIGHT_OFFSET+82, playerBg, 1, 1, 3, GameObject::Right);
	//GameObject car2 = GameObject(64, 64, 350, TILE1_HEIGHT_OFFSET+82, playerBg, 1, 2, 2, GameObject::Right);
	GameObject car3 = GameObject(64, 64, 700, TILE3_HEIGHT_OFFSET+82, playerBg, 1, 3, 2, GameObject::Left);
	GameObject car4 = GameObject(64, 64, 80, TILE3_HEIGHT_OFFSET+82, playerBg, 1, 4, 2, GameObject::Left);
	GameObject car5 = GameObject(64, 64, 450, TILE4_HEIGHT_OFFSET+82, playerBg, 1, 5, 2, GameObject::Right);
	GameObject car6 = GameObject(64, 64, 130, TILE4_HEIGHT_OFFSET+82, playerBg, 1, 6, 2, GameObject::Right);
	GameObject car7 = GameObject(64, 64, 80, TILE_OUTSIDE_OFFSET, playerBg, 1, 7, 2, GameObject::Left);
	GameObject car8 = GameObject(64, 64, 450, TILE_OUTSIDE_OFFSET, playerBg, 1, 8, 2, GameObject::Left);
	GameObject car9 = GameObject(64, 64, 510, TILE_OUTSIDE_OFFSET, playerBg, 1, 9, 2, GameObject::Right);
	GameObject car10 = GameObject(64, 64, 700, TILE_OUTSIDE_OFFSET, playerBg, 1, 10, 2, GameObject::Right);
	*/

	Car car1 = Car(620, TILE1_HEIGHT_OFFSET+82, playerBg, 1, 1, GameObject::Right);
	Car car2 = Car(350, TILE1_HEIGHT_OFFSET+82, playerBg, 1, 2, GameObject::Right);
	Car car3 = Car(700, TILE3_HEIGHT_OFFSET+82, playerBg, 1, 3, GameObject::Right);
	Car car4 = Car(350, TILE1_HEIGHT_OFFSET+82, playerBg, 1, 4, GameObject::Right);
	Car car5 = Car(450, TILE4_HEIGHT_OFFSET+82, playerBg, 1, 5, GameObject::Right);
	Car car6 = Car(130, TILE4_HEIGHT_OFFSET+82, playerBg, 1, 6, GameObject::Right);
	Car car7 = Car(80, TILE_OUTSIDE_OFFSET, playerBg, 1, 7, GameObject::Left);
	Car car8 = Car(450, TILE_OUTSIDE_OFFSET, playerBg, 1, 8, GameObject::Left);
	Car car9 = Car(510, TILE_OUTSIDE_OFFSET, playerBg, 1, 9, GameObject::Right);
	Car car10 = Car(700, TILE_OUTSIDE_OFFSET, playerBg, 1, 10, GameObject::Right);


	GameObject* gameObjects[] = {&car1, &car2, &car3, &car4, &car5, &car6, &car7, &car8, &car9, &car10};

	while(1){

		for( int i = 0; i<10; i++){
			gameObjects[i]->draw();
			gameObjects[i]->updatePos();
		}

		tileTransition(gameObjects, objBg);

		playerKeyboard->getKeyboardAction();
		playerFrog->updatePos();
		playerFrog->draw();

		playerBg->update();
		playerBg->draw();

		if(playerFrog->IsColliding(gameObjects, 10))
			playerFrog->reset();

		usleep(2000);
	}
}
